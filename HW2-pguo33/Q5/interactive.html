<!DOCTYPE html>
    <meta charset="UTF-8">
    <title>interactive</title>
    <script src="../lib/d3.v5.min.js"></script>
    <style>
        div {
            text-align: center;
        }
        .axis path,
        .axis line {
            fill: none;
            display: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
        .axis text {
            font-family: sans-serif;
            fill: #af8dc3;
            font-size: 16px;
        }

        .axis2 path,
        .axis2 line {
            fill: none;
            stroke: #af8dc3;
            shape-rendering: crispEdges;
        }
        .axis2 text {
            font-family: sans-serif;
            fill: #af8dc3;
            font-size: 11px;
            font-weight: lighter;
        }
        text {
            fill: white;
            font-family: sans-serif;
            font-size: 11px;
        }
        .label {
            fill: #af8dc3;
            font-family: sans-serif;
            font-size: 11px;

        }
    </style>
<body>
<div id="chart"></div>
<script>

    // initialization
    var margin = {top: 150, right: 0, bottom: 50, left: 50},
        width = 1000 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom,
        x = d3.scaleLinear().range([0, width / 2]),
        y = d3.scaleBand().range([100, height]),
        svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var data = [{country: 'Bangladesh', population_2012: 105905297, growth: {year_2013:42488 , year_2014:934 , year_2015:52633 , year_2016:112822 , year_2017:160792}},
        {country: 'Ethopia', population_2012: 75656319, growth: {year_2013:1606010 , year_2014:1606705 , year_2015:1600666 , year_2016:1590077 , year_2017:1580805}},
        {country: 'Kenya', population_2012: 33007327, growth: {year_2013:705153 , year_2014:703994 , year_2015:699906 , year_2016:694295 , year_2017:687910}},
        {country: 'Afghanistan', population_2012: 23280573, growth: {year_2013:717151 , year_2014:706082 , year_2015:665025 , year_2016:616262 , year_2017:573643}},
        {country: 'Morocco', population_2012: 13619520, growth: {year_2013:11862 , year_2014:7997 , year_2015:391 , year_2016:-8820 , year_2017:-17029}}];

    // read the data into a handy format
    var formatted = data.map(function(d) {
        var total = d.population_2012 + d.growth.year_2013 + d.growth.year_2014 + d.growth.year_2015 + d.growth.year_2016 + d.growth.year_2017,
            value = [d.growth.year_2013/d.population_2012, d.growth.year_2014/(d.population_2012 + d.growth.year_2013), d.growth.year_2015/(d.population_2012 + d.growth.year_2013 + d.growth.year_2014), d.growth.year_2016/(d.population_2012 + d.growth.year_2013 + d.growth.year_2014 + d.growth.year_2015), d.growth.year_2017/(d.population_2012 + d.growth.year_2013 + d.growth.year_2014 + d.growth.year_2015 + d.growth.year_2016)];
        return {
            name: d.country,
            value: d3.zip([2013, 2014, 2015, 2016, 2017], value),
            total: total
        }
    });

    // input the domains for x and y scale
    x.domain([0, d3.max(formatted, function(d) { return d.total; })]);
    y.domain(formatted.map(function(d) {return d.name; }));

    // create y axis
    var yAxis = d3.axisLeft()
        .scale(y);

    svg.append("g")
        .attr("class", "axis")
        .attr("transform","translate(100, 0)")
        .call(yAxis);

    // draw the bars!
    var bars = svg.selectAll(".bar")
        .data(formatted)
        .enter()
        .append("g")
        .attr("class", "bar")
        .attr("transform", function(d) { return "translate(100, " +
            (y.bandwidth() * 0.2 + y(d.name)) + ")"; });

    bars.append("rect")
        .attr("width", function(d) { return x(d.total); })
        .attr("height", y.bandwidth() * 0.6)
        .style("fill", "#af8dc3")
        .on("mouseover", showInfo)
        .on("mouseout", hideInfo);

function addCommas(val) {
            var sIntNum = val.toString(), 
                bIndex = sIntNum.indexOf('.'); 
            return  sIntNum.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,function($0,i){return bIndex < 0 || i < bIndex?($0 + ',' ): $0                    })
        }

    // add the labels for the bars
    bars.append("text")
        .attr("x", 3)
        .attr("y", y.bandwidth() * 0.3)
        .attr("dy", ".35em")
        .text(function(d) { return addCommas(d.total)
        });

    function showInfo(data) {
        // clear unwanted previous data
        d3.selectAll(".info").remove();

        // change the color of the selected bar
        d3.select(this).style("fill", "#91cf60");

        // initialization for the new line chart
        var info = svg.append("svg")
            .attr("class", "info")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + (200 + width / 2) + "," + height * 0.3 + ")");

        // create x and y axis for the line chart
        var x2 = d3.scaleLinear().domain([2013, 2017]).range([0, 150]),
            xAxis2 = d3.axisBottom()
                .scale(x2)
                .ticks(5)
                .tickFormat(d3.format("d"));

        info.append("g")
            .attr("class", "axis2")
            .attr("transform", "translate(0, 120)")
            .call(xAxis2);

        var y2 = d3.scaleLinear().domain([d3.min(data.value, function(d) {
            console.log(d[0])
            console.log(d[1]);
            return d[1];}),
            d3.max(data.value, function(d) {return d[1]; })])
                .range([120, 0]),
            yAxis2 = d3.axisLeft()
                .ticks(5)
                .scale(y2);

        info.append("g")
            .attr("class", "axis2")
            .call(yAxis2);

        // add the labels
        info.append("text")
            .attr("class", "label")
            .attr("x", 150)
            .attr("y", 160)
            .attr("text-anchor", "end")
            .text("Year");

        info.append("text")
            .attr("class", "label")
            .attr("x", -10)
            .attr("y", -15)
            .attr("text-anchor", "end")
            .text("Pct %");

        // draw the line!!!
        var line = d3.line()
            .x(function(d) { return x2(d[0]); })
            .y(function(d) { return y2(d[1]); });

        info.append("path")
            .attr("d", line(data.value))
            .style("stroke", "#91cf60")
            .style("stroke-width", 2)
            .style("fill", "none");
    }

    function hideInfo() {
        d3.selectAll(".info").remove();
        d3.select(this).style("fill", "#af8dc3");
    }

</script>
</body>
</html>